<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly Math Functions Test - Phase 1</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 120px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .result {
            font-weight: bold;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            color: #007bff;
            font-style: italic;
        }
        
        .console {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .test-results {
            margin: 20px 0;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ WebAssembly Math Functions Test</h1>
        <p>This page tests the integration between C++ math functions and JavaScript through WebAssembly.</p>
        
        <div id="status" class="status loading">
            üîÑ Initializing WebAssembly module...
        </div>

        <div class="section">
            <h2>üîß Manual Testing</h2>
            <p>Test the math functions with your own values:</p>
            
            <div class="input-group">
                <label>Sum:</label>
                <input type="number" id="sumA" value="5" step="any">
                <span>+</span>
                <input type="number" id="sumB" value="3" step="any">
                <button onclick="testSum()" id="sumBtn" disabled>Calculate</button>
            </div>
            <div id="sumResult"></div>
            
            <div class="input-group">
                <label>Multiply:</label>
                <input type="number" id="mulA" value="4" step="any">
                <span>√ó</span>
                <input type="number" id="mulB" value="7" step="any">
                <button onclick="testMultiply()" id="mulBtn" disabled>Calculate</button>
            </div>
            <div id="mulResult"></div>
        </div>

        <div class="section">
            <h2>üß™ Automated Tests</h2>
            <button onclick="runAutomatedTests()" id="testBtn" disabled>Run All Tests</button>
            <div id="testResults"></div>
        </div>

        <div class="section">
            <h2>üìä Console Output</h2>
            <p>C++ and JavaScript debug output:</p>
            <div id="console" class="console"></div>
            <button onclick="clearConsole()">Clear Console</button>
        </div>
    </div>

    <script type="module">
        // Import our wrapper (we'll handle fallback for different scenarios)
        let MathWasmWrapper;
        let mathWrapper;

        // Console capture for display
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console');

        function appendToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : '#00ff00';
            consoleOutput.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            appendToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            appendToConsole(args.join(' '), 'error');
        };

        window.clearConsole = function() {
            consoleOutput.innerHTML = '';
        };

        // Status update helper
        function updateStatus(message, type = 'loading') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        // Initialize WebAssembly
        async function initializeWasm() {
            try {
                updateStatus('üîÑ Loading WebAssembly wrapper...', 'loading');
                
                // Try to load the wrapper
                try {
                    const module = await import('../js/math_wrapper.js');
                    MathWasmWrapper = module.default;
                } catch (importError) {
                    console.error('Failed to import wrapper, trying fallback:', importError);
                    // Fallback: include wrapper directly if import fails
                    if (window.MathWasmWrapper) {
                        MathWasmWrapper = window.MathWasmWrapper;
                    } else {
                        throw new Error('MathWasmWrapper not available');
                    }
                }

                updateStatus('üîÑ Initializing WebAssembly module...', 'loading');
                mathWrapper = new MathWasmWrapper();
                await mathWrapper.initialize();
                
                updateStatus('‚úÖ WebAssembly module ready!', 'ready');
                
                // Enable buttons
                document.getElementById('sumBtn').disabled = false;
                document.getElementById('mulBtn').disabled = false;
                document.getElementById('testBtn').disabled = false;
                
                console.log('üéâ All systems ready!');
                
            } catch (error) {
                console.error('Initialization failed:', error);
                updateStatus(`‚ùå Failed to load: ${error.message}`, 'error');
            }
        }

        // Test functions
        window.testSum = function() {
            try {
                const a = parseFloat(document.getElementById('sumA').value);
                const b = parseFloat(document.getElementById('sumB').value);
                
                const result = mathWrapper.sum(a, b);
                document.getElementById('sumResult').innerHTML = 
                    `<div class="result success">Result: ${result}</div>`;
                    
            } catch (error) {
                document.getElementById('sumResult').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        };

        window.testMultiply = function() {
            try {
                const a = parseFloat(document.getElementById('mulA').value);
                const b = parseFloat(document.getElementById('mulB').value);
                
                const result = mathWrapper.multiply(a, b);
                document.getElementById('mulResult').innerHTML = 
                    `<div class="result success">Result: ${result}</div>`;
                    
            } catch (error) {
                document.getElementById('mulResult').innerHTML = 
                    `<div class="result error">Error: ${error.message}</div>`;
            }
        };

        window.runAutomatedTests = function() {
            try {
                console.log('üöÄ Starting automated tests...');
                const results = mathWrapper.runTests();
                
                let html = '<div class="test-results"><h3>Test Results:</h3>';
                
                // Sum tests
                html += '<h4>Sum Function Tests:</h4><ul>';
                for (const [test, result] of Object.entries(results.sum)) {
                    html += `<li>${test}: ${result}</li>`;
                }
                html += '</ul>';
                
                // Multiply tests
                html += '<h4>Multiply Function Tests:</h4><ul>';
                for (const [test, result] of Object.entries(results.multiply)) {
                    html += `<li>${test}: ${result}</li>`;
                }
                html += '</ul>';
                
                // Errors
                if (results.errors.length > 0) {
                    html += '<h4>Errors:</h4><ul>';
                    results.errors.forEach(error => {
                        html += `<li class="error">${error}</li>`;
                    });
                    html += '</ul>';
                }
                
                html += '</div>';
                document.getElementById('testResults').innerHTML = html;
                
            } catch (error) {
                document.getElementById('testResults').innerHTML = 
                    `<div class="result error">Test failed: ${error.message}</div>`;
            }
        };

        // Initialize everything when page loads
        initializeWasm();
    </script>

    <!-- Fallback for browsers that don't support ES6 modules -->
    <script>
        // Check if modules are supported, if not, show error
        if (!('noModule' in HTMLScriptElement.prototype)) {
            setTimeout(() => {
                if (!window.MathWasmWrapper) {
                    updateStatus('‚ùå Browser does not support ES6 modules. Please use a modern browser.', 'error');
                }
            }, 2000);
        }
    </script>
</body>
</html>